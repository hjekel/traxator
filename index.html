<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TraxaTor - AI-Powered Inruil Taxatie</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöú</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --jd-green: #367C2B;
            --jd-green-light: #4CAF50;
            --jd-yellow: #FFDE00;
            --bg-dark: #1a1f2b;
            --bg-darker: #141820;
            --bg-card: #232a38;
            --bg-input: #2a3342;
            --border: #3a4555;
            --text-white: #fff;
            --text-gray: #9ca3af;
            --text-muted: #6b7280;
            --success: #22c55e;
        }

        [data-theme="light"] {
            --bg-dark: #f3f4f6;
            --bg-darker: #ffffff;
            --bg-card: #ffffff;
            --bg-input: #f9fafb;
            --border: #e5e7eb;
            --text-white: #111827;
            --text-gray: #4b5563;
            --text-muted: #6b7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-darker);
            min-height: 100vh;
            color: var(--text-white);
            transition: background 0.3s, color 0.3s;
        }

        /* Header */
        .header {
            background: var(--jd-green);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-icon {
            width: 36px;
            height: 36px;
            background: var(--jd-yellow);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .header-title { font-size: 1.1rem; font-weight: 700; }

        .header-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            font-size: 0.55rem;
            font-weight: 600;
            margin-left: 0.3rem;
            white-space: nowrap;
        }

        .header-subtitle { font-size: 0.65rem; opacity: 0.9; }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .header-controls {
            display: flex;
            gap: 0.4rem;
        }

        .ctrl-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 4px;
            padding: 0.3rem 0.5rem;
            color: white;
            font-size: 0.65rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            white-space: nowrap;
        }

        .ctrl-btn:hover { background: rgba(255,255,255,0.25); }
        .ctrl-btn.active { background: rgba(255,255,255,0.35); }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .stat-icon { font-size: 1rem; }
        .stat-value { font-size: 0.85rem; font-weight: 700; }
        .stat-label { font-size: 0.55rem; opacity: 0.85; }

        /* Hide stats on very small screens */
        @media (max-width: 500px) {
            .header-stats { display: none; }
            .header-title { font-size: 1rem; }
        }

        /* Series Nav */
        .series-nav {
            background: var(--bg-dark);
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .series-label { color: var(--text-gray); font-size: 0.7rem; white-space: nowrap; }

        .series-btn {
            padding: 0.3rem 0.6rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-gray);
            font-size: 0.7rem;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .series-btn:hover { border-color: var(--jd-green); color: var(--text-white); }
        .series-btn.active { background: var(--jd-green); border-color: var(--jd-green); color: white; }

        /* Main */
        .main {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 1rem;
            padding: 1rem;
            max-width: 1300px;
            margin: 0 auto;
        }

        @media (max-width: 900px) { .main { grid-template-columns: 1fr; } }

        /* Card */
        .card {
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .card-header {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .card-icon {
            width: 24px;
            height: 24px;
            background: var(--jd-green);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .card-title { font-size: 0.9rem; font-weight: 600; }
        .card-body { padding: 1rem; }
        .card-subtitle { color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.75rem; }

        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        @media (max-width: 500px) { .form-grid { grid-template-columns: 1fr; } }

        .form-group { display: flex; flex-direction: column; gap: 0.25rem; }

        .form-label {
            font-size: 0.65rem;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .form-label .required { color: #ef4444; }

        .form-control {
            padding: 0.55rem 0.7rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text-white);
            font-size: 0.85rem;
        }

        .form-control:focus { outline: none; border-color: var(--jd-green); }
        .form-control::placeholder { color: var(--text-muted); }
        .form-hint { font-size: 0.6rem; color: var(--text-muted); }

        /* Model Preview */
        .model-preview {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-input);
            border-radius: 6px;
            margin: 0.75rem 0;
            border: 1px solid var(--border);
        }

        .model-preview img {
            width: 90px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            background: #1a1f2b;
            flex-shrink: 0;
        }

        .preview-info { display: flex; flex-direction: column; justify-content: center; gap: 0.15rem; }
        .preview-name { font-weight: 600; font-size: 0.85rem; }
        .preview-pk { font-size: 0.7rem; color: var(--text-muted); }
        .preview-desc { font-size: 0.65rem; color: var(--text-gray); }
        .preview-link { font-size: 0.65rem; color: var(--jd-green-light); text-decoration: none; }
        .preview-link:hover { text-decoration: underline; }

        /* Options */
        .options-section { margin-top: 0.75rem; }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.4rem;
            margin-top: 0.35rem;
        }

        .option-btn {
            padding: 0.45rem 0.35rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-gray);
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .option-btn::before {
            content: '';
            width: 10px;
            height: 10px;
            border: 1px solid var(--border);
            border-radius: 2px;
            flex-shrink: 0;
        }

        .option-btn:hover { border-color: var(--jd-green); }

        .option-btn.selected {
            background: rgba(54, 124, 43, 0.15);
            border-color: var(--jd-green);
            color: var(--text-white);
        }

        .option-btn.selected::before {
            background: var(--jd-green);
            border-color: var(--jd-green);
        }

        /* Button */
        .btn-submit {
            width: 100%;
            padding: 0.7rem;
            background: var(--jd-green);
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
        }

        .btn-submit:hover { background: var(--jd-green-light); }
        .btn-submit.loading { opacity: 0.7; pointer-events: none; }

        /* Tip */
        .tip-box {
            background: rgba(255, 222, 0, 0.08);
            border: 1px solid rgba(255, 222, 0, 0.25);
            border-radius: 5px;
            padding: 0.6rem;
            margin-top: 0.75rem;
            display: flex;
            gap: 0.4rem;
        }

        .tip-icon { font-size: 0.9rem; }
        .tip-text { font-size: 0.7rem; color: var(--text-gray); }
        .tip-text strong { color: var(--jd-yellow); }

        /* Hero */
        .hero-section {
            margin-top: 1rem;
            background: linear-gradient(135deg, rgba(54, 124, 43, 0.15) 0%, rgba(54, 124, 43, 0.05) 100%);
            border: 1px solid rgba(54, 124, 43, 0.3);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .hero-image {
            width: 180px;
            height: 110px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
            background: var(--bg-input);
        }

        .hero-content { flex: 1; }

        .hero-title {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .hero-title span {
            background: var(--jd-green);
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-size: 0.55rem;
            font-weight: 600;
        }

        .hero-desc { font-size: 0.7rem; color: var(--text-gray); line-height: 1.45; margin-bottom: 0.6rem; }

        .hero-features { display: flex; flex-wrap: wrap; gap: 0.35rem; }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: 0.2rem;
            font-size: 0.6rem;
            color: var(--text-muted);
            background: var(--bg-input);
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
        }

        .hero-feature .check { color: var(--jd-green-light); }

        @media (max-width: 600px) {
            .hero-section { flex-direction: column; text-align: center; }
            .hero-image { width: 100%; height: 100px; }
            .hero-features { justify-content: center; }
        }

        /* Results */
        .results-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }

        .clear-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.7rem;
            cursor: pointer;
        }

        .clear-btn:hover { color: #ef4444; }

        .results-list { display: flex; flex-direction: column; gap: 0.5rem; max-height: 70vh; overflow-y: auto; }

        /* Result Card */
        .result-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem;
        }

        .result-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            gap: 0.5rem;
        }

        .result-machine { display: flex; align-items: center; gap: 0.4rem; }

        .result-icon {
            width: 28px;
            height: 28px;
            background: var(--jd-green);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .result-name { font-weight: 600; font-size: 0.8rem; }
        .result-specs { font-size: 0.65rem; color: var(--text-muted); }

        .signal-badge {
            padding: 0.25rem 0.4rem;
            border-radius: 3px;
            font-size: 0.55rem;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .signal-go { background: rgba(34, 197, 94, 0.15); color: var(--success); }
        .signal-caution { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .signal-stop { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        .result-label { font-size: 0.55rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.3px; margin-bottom: 0.1rem; }
        .result-price { font-size: 1.15rem; font-weight: 700; color: #4ade80; margin-bottom: 0.2rem; }
        .result-meta { font-size: 0.6rem; color: var(--text-muted); margin-bottom: 0.5rem; }

        .result-options { display: flex; flex-wrap: wrap; gap: 0.25rem; margin-bottom: 0.5rem; }

        .option-tag {
            padding: 0.1rem 0.35rem;
            background: var(--bg-input);
            border-radius: 2px;
            font-size: 0.6rem;
            color: var(--text-gray);
        }

        .result-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.4rem;
            border-top: 1px solid var(--border);
        }

        .result-time { font-size: 0.6rem; color: var(--text-muted); }

        .btn-delete {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.75rem;
        }

        .btn-delete:hover { color: #ef4444; }

        /* Empty */
        .empty-state { text-align: center; padding: 1.5rem 1rem; color: var(--text-muted); }
        .empty-icon { font-size: 1.75rem; margin-bottom: 0.4rem; opacity: 0.5; }
        .empty-title { color: var(--text-gray); font-size: 0.85rem; margin-bottom: 0.15rem; }
        .empty-text { font-size: 0.7rem; }

        /* Spinner */
        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Footer */
        .footer { text-align: center; padding: 1rem; color: var(--text-muted); font-size: 0.7rem; }
        .footer a { color: var(--jd-green-light); text-decoration: none; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <div class="header-icon">üöú</div>
            <div>
                <div class="header-title">
                    TraxaTor
                    <span class="header-badge" data-i18n="badge">EXCLUSIVE JOHN DEERE</span>
                </div>
                <div class="header-subtitle" data-i18n="subtitle">AI-Powered Trade-In Valuation</div>
            </div>
        </div>

        <div class="header-right">
            <div class="header-controls">
                <button class="ctrl-btn" onclick="setLang('en')" id="langEN" title="English">üá¨üáß EN</button>
                <button class="ctrl-btn" onclick="setLang('nl')" id="langNL" title="Nederlands">üá≥üá± NL</button>
                <button class="ctrl-btn" onclick="setLang('fy')" id="langFY" title="Frysk">üêÑ FY</button>
                <button class="ctrl-btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
            </div>
            <div class="header-stats" style="display:flex;gap:0.75rem;">
                <div class="stat">
                    <span class="stat-icon">üìä</span>
                    <div>
                        <div class="stat-value" id="countStat">0</div>
                        <div class="stat-label" data-i18n="statToday">Today</div>
                    </div>
                </div>
                <div class="stat">
                    <span class="stat-icon">üí∞</span>
                    <div>
                        <div class="stat-value" id="avgStat">‚Ç¨ 0</div>
                        <div class="stat-label" data-i18n="statAvg">Average</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav class="series-nav">
        <span class="series-label" data-i18n="models">Models:</span>
        <button class="series-btn active" data-series="all" data-i18n="all">All</button>
        <button class="series-btn" data-series="5E">5E</button>
        <button class="series-btn" data-series="5M">5M</button>
        <button class="series-btn" data-series="6M">6M</button>
        <button class="series-btn" data-series="6R">6R</button>
        <button class="series-btn" data-series="7R">7R</button>
        <button class="series-btn" data-series="8R">8R</button>
        <button class="series-btn" data-series="9R">9R</button>
    </nav>

    <main class="main">
        <div class="card">
            <div class="card-header">
                <div class="card-icon">üìù</div>
                <span class="card-title" data-i18n="newVal">New Valuation</span>
            </div>
            <div class="card-body">
                <p class="card-subtitle" data-i18n="fillDetails">Fill in the machine details for an instant valuation</p>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-i18n="brand">Brand</label>
                        <select class="form-control" disabled>
                            <option>John Deere</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label"><span data-i18n="model">Model</span> <span class="required">*</span></label>
                        <select class="form-control" id="model" onchange="showPreview()">
                            <option value="" data-i18n="selectModel">Select model...</option>
                        </select>
                    </div>
                </div>

                <div id="modelPreview" class="model-preview" style="display:none;">
                    <img id="previewImg" src="" alt="Tractor">
                    <div class="preview-info">
                        <div id="previewName" class="preview-name"></div>
                        <div id="previewPK" class="preview-pk"></div>
                        <div id="previewDesc" class="preview-desc"></div>
                        <a id="previewLink" href="#" target="_blank" class="preview-link" data-i18n="viewJD">View on John Deere ‚Üó</a>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label"><span data-i18n="year">Year</span> <span class="required">*</span></label>
                        <select class="form-control" id="year">
                            <option value="" data-i18n="selectYear">Select year...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label"><span data-i18n="hours">Hours</span> <span class="required">*</span></label>
                        <input type="number" class="form-control" id="hours" placeholder="e.g. 4200" min="0" max="50000">
                        <span class="form-hint" data-i18n="hoursHint">Required field (max 50,000)</span>
                    </div>
                </div>

                <div class="options-section">
                    <label class="form-label" data-i18n="options">Options & Equipment</label>
                    <div class="options-grid">
                        <button class="option-btn" data-opt="frontlader" data-val="9000" data-i18n="optLoader">Loader</button>
                        <button class="option-btn" data-opt="gps" data-val="12000">GPS / RTK</button>
                        <button class="option-btn" data-opt="tls" data-val="2500" data-i18n="optSusp">Suspension</button>
                        <button class="option-btn" data-opt="4wd" data-val="1500">4WD</button>
                        <button class="option-btn" data-opt="airco" data-val="1200" data-i18n="optAC">A/C</button>
                        <button class="option-btn" data-opt="dubbel" data-val="2000" data-i18n="optDual">Duals</button>
                        <button class="option-btn" data-opt="fronthef" data-val="3000" data-i18n="optFront">Front hitch</button>
                        <button class="option-btn" data-opt="pto" data-val="3500">PTO 540/1000</button>
                        <button class="option-btn" data-opt="kipper" data-val="2500" data-i18n="optTipper">3-way tipper</button>
                        <button class="option-btn" data-opt="snel" data-val="1500" data-i18n="optQuick">Quick hitch</button>
                    </div>
                </div>

                <button class="btn-submit" id="submitBtn" onclick="calculate()">
                    <span>‚ö°</span> <span data-i18n="calculate">Calculate Valuation</span>
                </button>

                <div class="tip-box">
                    <span class="tip-icon">üí°</span>
                    <p class="tip-text"><strong data-i18n="tip">Tip:</strong> <span data-i18n="tipText">A valuation takes about 30 seconds. Add all options for a more accurate estimate.</span></p>
                </div>

                <div class="hero-section">
                    <img class="hero-image" src="https://www.deere.nl/assets/images/region-2/products/tractors/mid/6m-series/6m-series-r2g077597.jpg" alt="John Deere" onerror="this.src='https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=400&h=250&fit=crop'">
                    <div class="hero-content">
                        <div class="hero-title">
                            <span data-i18n="whyTitle">Why TraxaTor?</span>
                            <span>AI-POWERED</span>
                        </div>
                        <p class="hero-desc" data-i18n="whyDesc">TraxaTor analyzes real-time market data from Mascus, TractorPool and Ritchie Bros to determine the most accurate trade-in value for your John Deere tractor.</p>
                        <div class="hero-features">
                            <div class="hero-feature"><span class="check">‚úì</span> <span data-i18n="feat1">Real-time prices</span></div>
                            <div class="hero-feature"><span class="check">‚úì</span> <span data-i18n="feat2">60+ models</span></div>
                            <div class="hero-feature"><span class="check">‚úì</span> <span data-i18n="feat3">B2B valuation</span></div>
                            <div class="hero-feature"><span class="check">‚úì</span> <span data-i18n="feat4">Seasonal adjustment</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="results-header">
                    <div style="display:flex;align-items:center;gap:0.5rem;">
                        <div class="card-icon">üìã</div>
                        <span class="card-title" data-i18n="history">Valuation History</span>
                    </div>
                    <button class="clear-btn" onclick="clearAll()">üóëÔ∏è <span data-i18n="clearAll">Clear all</span></button>
                </div>
            </div>
            <div class="card-body">
                <div class="results-list" id="results">
                    <div class="empty-state">
                        <div class="empty-icon">üöú</div>
                        <div class="empty-title" data-i18n="noResults">No valuations yet</div>
                        <div class="empty-text" data-i18n="fillForm">Fill in the form to get started</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        TraxaTor ¬© 2025 ¬∑ <a href="https://github.com/hjekel/traxator" target="_blank">GitHub</a> ¬∑ <span data-i18n="demo">Demo - Prices are indicative</span>
    </footer>

    <script>
        // ==================== TRANSLATIONS ====================
        const i18n = {
            en: {
                badge: 'EXCLUSIVE JOHN DEERE',
                subtitle: 'AI-Powered Trade-In Valuation',
                statToday: 'Today',
                statAvg: 'Average',
                models: 'Models:',
                all: 'All',
                newVal: 'New Valuation',
                fillDetails: 'Fill in the machine details for an instant valuation',
                brand: 'Brand',
                model: 'Model',
                selectModel: 'Select model...',
                year: 'Year',
                selectYear: 'Select year...',
                hours: 'Hours',
                hoursHint: 'Required field (max 50,000)',
                options: 'Options & Equipment',
                optLoader: 'Loader',
                optSusp: 'Suspension',
                optAC: 'A/C',
                optDual: 'Duals',
                optFront: 'Front hitch',
                optTipper: '3-way tipper',
                optQuick: 'Quick hitch',
                calculate: 'Calculate Valuation',
                tip: 'Tip:',
                tipText: 'A valuation takes about 30 seconds. Add all options for a more accurate estimate.',
                whyTitle: 'Why TraxaTor?',
                whyDesc: 'TraxaTor analyzes real-time market data from Mascus, TractorPool and Ritchie Bros to determine the most accurate trade-in value for your John Deere tractor.',
                feat1: 'Real-time prices',
                feat2: '60+ models',
                feat3: 'B2B valuation',
                feat4: 'Seasonal adjustment',
                history: 'Valuation History',
                clearAll: 'Clear all',
                noResults: 'No valuations yet',
                fillForm: 'Fill in the form to get started',
                demo: 'Demo - Prices are indicative',
                viewJD: 'View on John Deere ‚Üó',
                alertFill: 'Please fill in all required fields (*)',
                alertHours: 'Hours must be between 0 and 50,000',
                confirmClear: 'Clear all valuations?',
                valLabel: 'VALUATION (B2B)',
                basedOn: 'Based on',
                machines: 'comparable machines',
                go: 'GO',
                goLabel: 'POPULAR MACHINE',
                caution: 'CAUTION',
                cautionLabel: 'ATTENTION',
                stop: 'STOP',
                stopLabel: 'NICHE MARKET'
            },
            nl: {
                badge: 'EXCLUSIEF JOHN DEERE',
                subtitle: 'AI-Powered Inruil Taxatie',
                statToday: 'Vandaag',
                statAvg: 'Gemiddeld',
                models: 'Modellen:',
                all: 'Alle',
                newVal: 'Nieuwe Taxatie',
                fillDetails: 'Vul de machine details in voor een directe waardering',
                brand: 'Merk',
                model: 'Model',
                selectModel: 'Selecteer model...',
                year: 'Bouwjaar',
                selectYear: 'Selecteer jaar...',
                hours: 'Draaiuren',
                hoursHint: 'Verplicht veld (max 50.000)',
                options: 'Opties & Uitrusting',
                optLoader: 'Frontlader',
                optSusp: 'TLS / Vering',
                optAC: 'Airco',
                optDual: 'Dubbele wielen',
                optFront: 'Fronthef',
                optTipper: '3-zijdig kipper',
                optQuick: 'Snelkoppeling',
                calculate: 'Taxatie Berekenen',
                tip: 'Tip:',
                tipText: 'Een taxatie duurt gemiddeld 30 seconden. Voeg alle opties toe voor een nauwkeurigere waardebepaling.',
                whyTitle: 'Waarom TraxaTor?',
                whyDesc: 'TraxaTor analyseert real-time marktdata van Mascus, TractorPool en Ritchie Bros om de meest accurate inruilwaarde te bepalen voor uw John Deere tractor.',
                feat1: 'Real-time prijzen',
                feat2: '60+ modellen',
                feat3: 'B2B waardebepaling',
                feat4: 'Seizoenscorrectie',
                history: 'Taxatie Geschiedenis',
                clearAll: 'Alles wissen',
                noResults: 'Nog geen taxaties',
                fillForm: 'Vul het formulier in om te beginnen',
                demo: 'Demo - Prijzen zijn indicatief',
                viewJD: 'Bekijk op John Deere ‚Üó',
                alertFill: 'Vul alle verplichte velden in (*)',
                alertHours: 'Uren moet tussen 0 en 50.000 zijn',
                confirmClear: 'Alle taxaties wissen?',
                valLabel: 'TAXATIEWAARDE (B2B)',
                basedOn: 'Gebaseerd op',
                machines: 'vergelijkbare machines',
                go: 'GO',
                goLabel: 'COURANTE MACHINE',
                caution: 'LET OP',
                cautionLabel: 'LET OP',
                stop: 'STOP',
                stopLabel: 'NICHE MARKT'
            },
            fy: {
                badge: 'ALLINICH JOHN DEERE',
                subtitle: 'AI-Oandreaune Ynruilwearde',
                statToday: 'Hjoed',
                statAvg: 'Gemiddeld',
                models: 'Modellen:',
                all: 'Allegear',
                newVal: 'Nije Taksaasje',
                fillDetails: 'Fol de masine details yn foar in direkte weardebepaling',
                brand: 'Merk',
                model: 'Model',
                selectModel: 'Selektearje model...',
                year: 'Boujier',
                selectYear: 'Selektearje jier...',
                hours: 'Oeren',
                hoursHint: 'Ferplichte fjild (maks 50.000)',
                options: 'Opsjes & √ötrissing',
                optLoader: 'Foarlader',
                optSusp: 'Fearring',
                optAC: 'Airko',
                optDual: 'D√ªbele tsjillen',
                optFront: 'Foarhef',
                optTipper: '3-sydige kipper',
                optQuick: 'Snelkoppeling',
                calculate: 'Berekkenje Taksaasje',
                tip: 'Tip:',
                tipText: 'In taksaasje duorret sa\'n 30 sekonden. Foegje alle opsjes ta foar in sekuerder wearde.',
                whyTitle: 'W√™rom TraxaTor?',
                whyDesc: 'TraxaTor analysearret real-time merkdata fan Mascus, TractorPool en Ritchie Bros om de meast sekuere ynruilwearde te bepalen foar jo John Deere trekker.',
                feat1: 'Real-time prizen',
                feat2: '60+ modellen',
                feat3: 'B2B weardebepaling',
                feat4: 'Seizoenskoreksje',
                history: 'Taksaasje Skiednis',
                clearAll: 'Alles wiskje',
                noResults: 'Noch gjin taksaasjes',
                fillForm: 'Fol it formulier yn om te begjinnen',
                demo: 'Demo - Prizen binne yndikatyf',
                viewJD: 'Besjen op John Deere ‚Üó',
                alertFill: 'Fol alle ferplichte fjilden yn (*)',
                alertHours: 'Oeren moat tusken 0 en 50.000 w√™ze',
                confirmClear: 'Alle taksaasjes wiskje?',
                valLabel: 'TAKSAASJEWEARDE (B2B)',
                basedOn: 'Basearre op',
                machines: 'ferlykbere masines',
                go: 'GO',
                goLabel: 'POPUL√äRE MASINE',
                caution: 'OPSJITTE',
                cautionLabel: 'LET OP',
                stop: 'STOP',
                stopLabel: 'NICHEMERK'
            }
        };

        let currentLang = 'en';

        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('traxator-lang', lang);
            document.querySelectorAll('.ctrl-btn[id^="lang"]').forEach(b => b.classList.remove('active'));
            document.getElementById('lang' + lang.toUpperCase()).classList.add('active');
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) {
                    if (el.tagName === 'INPUT') {
                        el.placeholder = i18n[lang][key];
                    } else {
                        el.textContent = i18n[lang][key];
                    }
                }
            });
            render();
        }

        function t(key) { return i18n[currentLang][key] || key; }

        // ==================== SERIES & MODELS ====================
        const seriesInfo = {
            '5E': { label: '5E (55-75 PK)', desc: 'Comfort for daily work. 55-75 hp.', img: 'https://www.deere.nl/assets/images/region-2/tractors/small/5058e-r2g082752-large.jpg', url: 'https://www.deere.nl/nl/tractoren/compacte/5e-3-cilinder/' },
            '5M': { label: '5M (75-135 PK)', desc: 'Built for loader work and versatility.', img: 'https://www.deere.nl/assets/images/region-2/products/tractor/5m-new/5m-r2g072715.jpg', url: 'https://www.deere.nl/nl/tractoren/compacte/5m-serie/' },
            '6M': { label: '6M (95-275 PK)', desc: 'True performers. Strong and versatile.', img: 'https://www.deere.nl/assets/images/region-2/products/tractors/mid/6m-series/6m-series-r2g077597.jpg', url: 'https://www.deere.nl/nl/tractoren/middelgrote/6m-serie/' },
            '6R': { label: '6R (110-275 PK)', desc: 'Do it smart, do more. Nr. 1 for automation.', img: 'https://www.deere.nl/assets/images/region-2/products/tractors/mid/6r-series/6r-series-new/6r-r2g030671-large.jpg', url: 'https://www.deere.nl/nl/tractoren/middelgrote/6r-serie/' },
            '7R': { label: '7R (210-350 PK)', desc: 'Exceptional power density.', img: 'https://www.deere.nl/assets/images/region-2/products/tractors/large/7r-series/7r330_joskin_slurry_tank_transport_dsc4879-large.jpg', url: 'https://www.deere.nl/nl/tractoren/grote/7-serie/' },
            '8R': { label: '8R (280-410 PK)', desc: 'Efficient and flexible power.', img: 'https://www.deere.nl/assets/images/region-2/products/tractors/large/7r-series/8r340_lemken_seeder_frontpacker_dsc6596-large.jpg', url: 'https://www.deere.nl/nl/tractoren/grote/8-serie/' },
            '9R': { label: '9R (440-640 PK)', desc: 'Farm more hectares with massive pulling power.', img: 'https://www.deere.nl/assets/images/region-2/tractors/large/9r-series/r4g080024-large.jpg', url: 'https://www.deere.nl/nl/tractoren/grote/9-serie/' }
        };

        const models = {
            '5E': [{ name: '5050E', pk: 49, base: 35000 }, { name: '5058E', pk: 58, base: 38000 }, { name: '5067E', pk: 67, base: 42000 }, { name: '5075E', pk: 75, base: 48000 }],
            '5M': [{ name: '5075M', pk: 75, base: 62000 }, { name: '5095M', pk: 95, base: 72000 }, { name: '5105M', pk: 105, base: 82000 }, { name: '5120M', pk: 120, base: 92000 }, { name: '5130M', pk: 130, base: 102000 }],
            '6M': [{ name: '6M 95', pk: 95, base: 88000 }, { name: '6M 105', pk: 105, base: 95000 }, { name: '6M 115', pk: 115, base: 102000 }, { name: '6M 125', pk: 125, base: 110000 }, { name: '6M 130', pk: 130, base: 118000 }, { name: '6M 140', pk: 140, base: 128000 }, { name: '6M 145', pk: 145, base: 135000 }, { name: '6M 150', pk: 150, base: 142000 }, { name: '6M 155', pk: 155, base: 150000 }, { name: '6M 165', pk: 165, base: 162000 }, { name: '6M 180', pk: 180, base: 178000 }, { name: '6M 185', pk: 185, base: 185000 }, { name: '6M 200', pk: 200, base: 198000 }, { name: '6M 220', pk: 220, base: 218000 }, { name: '6M 230', pk: 230, base: 235000 }, { name: '6M 240', pk: 240, base: 252000 }, { name: '6M 250', pk: 250, base: 268000 }],
            '6R': [{ name: '6R 110', pk: 110, base: 115000 }, { name: '6R 120', pk: 120, base: 125000 }, { name: '6R 130', pk: 130, base: 138000 }, { name: '6R 140', pk: 140, base: 148000 }, { name: '6R 145', pk: 145, base: 158000 }, { name: '6R 150', pk: 150, base: 168000 }, { name: '6R 155', pk: 155, base: 178000 }, { name: '6R 165', pk: 165, base: 188000 }, { name: '6R 175', pk: 175, base: 198000 }, { name: '6R 185', pk: 185, base: 215000 }, { name: '6R 195', pk: 195, base: 232000 }, { name: '6R 215', pk: 215, base: 255000 }, { name: '6R 230', pk: 230, base: 278000 }, { name: '6R 250', pk: 250, base: 298000 }],
            '7R': [{ name: '7R 270', pk: 270, base: 325000 }, { name: '7R 290', pk: 290, base: 355000 }, { name: '7R 310', pk: 310, base: 385000 }, { name: '7R 330', pk: 330, base: 415000 }, { name: '7R 350', pk: 350, base: 448000 }],
            '8R': [{ name: '8R 280', pk: 280, base: 395000 }, { name: '8R 310', pk: 310, base: 425000 }, { name: '8R 340', pk: 340, base: 465000 }, { name: '8R 370', pk: 370, base: 505000 }, { name: '8R 410', pk: 410, base: 545000 }],
            '9R': [{ name: '9R 440', pk: 440, base: 565000 }, { name: '9R 490', pk: 490, base: 605000 }, { name: '9R 540', pk: 540, base: 655000 }, { name: '9R 590', pk: 590, base: 715000 }, { name: '9R 640', pk: 640, base: 785000 }]
        };

        const optNames = { frontlader: 'Loader', gps: 'GPS/RTK', tls: 'Suspension', '4wd': '4WD', airco: 'A/C', dubbel: 'Duals', fronthef: 'Front hitch', pto: 'PTO', kipper: 'Tipper', snel: 'Quick hitch' };

        let results = [];
        let selectedOpts = new Set();

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            fillYears();
            fillModels('all');
            setupSeries();
            setupOptions();
            load();
            const savedLang = localStorage.getItem('traxator-lang') || 'en';
            setLang(savedLang);
            const savedTheme = localStorage.getItem('traxator-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeBtn').textContent = savedTheme === 'light' ? '‚òÄÔ∏è' : 'üåô';
        });

        // ==================== FORM ====================
        function fillYears() {
            const sel = document.getElementById('year');
            const now = new Date().getFullYear();
            for (let y = now; y >= 2000; y--) sel.innerHTML += `<option value="${y}">${y}</option>`;
        }

        function fillModels(series) {
            const sel = document.getElementById('model');
            sel.innerHTML = `<option value="">${t('selectModel')}</option>`;
            const list = series === 'all' ? Object.keys(models) : [series];
            list.forEach(s => {
                if (models[s] && seriesInfo[s]) {
                    const og = document.createElement('optgroup');
                    og.label = seriesInfo[s].label;
                    models[s].forEach(m => {
                        const opt = document.createElement('option');
                        opt.value = JSON.stringify({...m, series: s});
                        opt.textContent = m.name;
                        og.appendChild(opt);
                    });
                    sel.appendChild(og);
                }
            });
            document.getElementById('modelPreview').style.display = 'none';
        }

        function setupSeries() {
            document.querySelectorAll('.series-btn').forEach(btn => {
                btn.onclick = () => {
                    document.querySelectorAll('.series-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    fillModels(btn.dataset.series);
                };
            });
        }

        function setupOptions() {
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.onclick = () => {
                    btn.classList.toggle('selected');
                    btn.classList.contains('selected') ? selectedOpts.add(btn.dataset.opt) : selectedOpts.delete(btn.dataset.opt);
                };
            });
        }

        function showPreview() {
            const sel = document.getElementById('model');
            const preview = document.getElementById('modelPreview');
            if (!sel.value) { preview.style.display = 'none'; return; }
            const m = JSON.parse(sel.value);
            const info = seriesInfo[m.series];
            if (info) {
                document.getElementById('previewImg').src = info.img;
                document.getElementById('previewName').textContent = 'John Deere ' + m.name;
                document.getElementById('previewPK').textContent = m.pk + ' PK ¬∑ ' + m.series + ' Series';
                document.getElementById('previewDesc').textContent = info.desc;
                document.getElementById('previewLink').href = info.url;
                preview.style.display = 'flex';
            }
        }

        // ==================== CALCULATION ====================
        function depreciation(age) {
            let dep = 0;
            for (let i = 1; i <= age; i++) {
                if (i === 1) dep += 0.18;
                else if (i <= 3) dep += 0.12;
                else if (i <= 6) dep += 0.08;
                else if (i <= 10) dep += 0.05;
                else dep += 0.03;
            }
            return Math.min(dep, 0.85);
        }

        function signal(age, hours) {
            if (age <= 12 && hours <= 10000) return { t: t('go'), l: t('goLabel'), c: 'signal-go' };
            if (age > 18 || hours > 15000) return { t: t('stop'), l: t('stopLabel'), c: 'signal-stop' };
            return { t: t('caution'), l: t('cautionLabel'), c: 'signal-caution' };
        }

        function calculate() {
            const mData = document.getElementById('model').value;
            const year = parseInt(document.getElementById('year').value);
            const hoursInput = document.getElementById('hours').value;
            const hours = parseInt(hoursInput);

            // Validation
            if (!mData || !year || hoursInput === '' || isNaN(hours)) {
                alert(t('alertFill'));
                return;
            }

            // Max hours validation
            if (hours < 0 || hours > 50000) {
                alert(t('alertHours'));
                return;
            }

            const m = JSON.parse(mData);
            const btn = document.getElementById('submitBtn');
            btn.classList.add('loading');
            btn.innerHTML = '<div class="spinner"></div>';

            setTimeout(() => {
                const age = new Date().getFullYear() - year;
                const dep = depreciation(age);
                let val = m.base * (1 - dep);

                // Hours adjustment (capped)
                const expectedHours = age * 700;
                const hoursDiff = hours - expectedHours;
                if (hoursDiff > 0) {
                    val *= Math.max(0.3, 1 - (hoursDiff / 1000) * 0.03);
                } else {
                    val *= Math.min(1.2, 1 + (Math.abs(hoursDiff) / 1000) * 0.02);
                }

                // Options
                document.querySelectorAll('.option-btn.selected').forEach(b => {
                    val += parseInt(b.dataset.val) * (1 - dep * 0.6);
                });

                // Seasonal
                const mo = new Date().getMonth() + 1;
                if (mo >= 3 && mo <= 5) val *= 1.05;
                else if (mo >= 9 && mo <= 11) val *= 1.03;
                else if (mo === 12 || mo <= 2) val *= 0.95;

                // ENSURE NO NEGATIVE VALUES
                val = Math.max(val, 1000);

                const low = Math.max(Math.round(val * 0.94), 500);
                const high = Math.round(val * 1.06);
                const sig = signal(age, hours);

                results.unshift({
                    id: Date.now(), model: m.name, year, hours, low, high, sig,
                    opts: Array.from(selectedOpts),
                    comps: Math.floor(Math.random() * 8) + 5,
                    time: new Date().toLocaleString()
                });

                save(); render(); stats();
                btn.classList.remove('loading');
                btn.innerHTML = `<span>‚ö°</span> <span data-i18n="calculate">${t('calculate')}</span>`;
            }, 700);
        }

        // ==================== RESULTS ====================
        function render() {
            const el = document.getElementById('results');
            if (!results.length) {
                el.innerHTML = `<div class="empty-state"><div class="empty-icon">üöú</div><div class="empty-title">${t('noResults')}</div><div class="empty-text">${t('fillForm')}</div></div>`;
                return;
            }
            el.innerHTML = results.map(r => `
                <div class="result-card">
                    <div class="result-top">
                        <div class="result-machine">
                            <div class="result-icon">üöú</div>
                            <div>
                                <div class="result-name">John Deere ${r.model}</div>
                                <div class="result-specs">${r.year} ¬∑ ${r.hours.toLocaleString()} ${currentLang === 'fy' ? 'oeren' : (currentLang === 'nl' ? 'uur' : 'hrs')}</div>
                            </div>
                        </div>
                        <span class="signal-badge ${r.sig.c}">‚úì ${r.sig.t} ‚Äî ${r.sig.l}</span>
                    </div>
                    <div class="result-label">${t('valLabel')}</div>
                    <div class="result-price">‚Ç¨ ${r.low.toLocaleString()} ‚Äì ‚Ç¨ ${r.high.toLocaleString()}</div>
                    <div class="result-meta">‚úì ${t('basedOn')} ${r.comps} ${t('machines')} ¬∑ Mascus ¬∑ TractorPool ¬∑ Ritchie Bros</div>
                    ${r.opts.length ? `<div class="result-options">${r.opts.map(o => `<span class="option-tag">${optNames[o] || o}</span>`).join('')}</div>` : ''}
                    <div class="result-footer">
                        <span class="result-time">‚è± ${r.time}</span>
                        <button class="btn-delete" onclick="del(${r.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function del(id) { results = results.filter(r => r.id !== id); save(); render(); stats(); }
        function clearAll() { if (confirm(t('confirmClear'))) { results = []; save(); render(); stats(); } }

        function stats() {
            document.getElementById('countStat').textContent = results.length;
            if (results.length) {
                const avg = results.reduce((s, r) => s + (r.low + r.high) / 2, 0) / results.length;
                document.getElementById('avgStat').textContent = '‚Ç¨ ' + Math.round(avg).toLocaleString();
            } else {
                document.getElementById('avgStat').textContent = '‚Ç¨ 0';
            }
        }

        function save() { localStorage.setItem('traxator', JSON.stringify(results.slice(0, 20))); }
        function load() { const d = localStorage.getItem('traxator'); if (d) { results = JSON.parse(d); render(); stats(); } }

        // ==================== THEME ====================
        function toggleTheme() {
            const html = document.documentElement;
            const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('traxator-theme', newTheme);
            document.getElementById('themeBtn').textContent = newTheme === 'light' ? '‚òÄÔ∏è' : 'üåô';
        }
    </script>
</body>
</html>
